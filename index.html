<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Flux Image Generator</title>
<style>
  body { font-family: Arial, sans-serif; text-align: center; margin-top: 50px; }
  input { width: 300px; padding: 10px; margin-bottom: 10px; border-radius: 5px; border: 1px solid #ccc; }
  button { padding: 10px 20px; border: none; border-radius: 5px; background-color: #0088cc; color: white; cursor: pointer; margin: 5px; }
  button:disabled { background-color: #ccc; cursor: not-allowed; }
  img { margin-top: 20px; max-width: 90%; border-radius: 10px; box-shadow: 0 0 10px rgba(0,0,0,0.2); }
</style>
</head>
<body>

<h1>Flux Image Generator</h1>
<input type="text" id="prompt" placeholder="Enter your prompt..." />
<br>
<button id="generateBtn">Generate</button>
<button id="regenerateBtn" disabled>Regenerate</button>
<button id="downloadBtn" disabled>Download</button>
<div id="result"></div>

<script>
const promptInput = document.getElementById("prompt");
const generateBtn = document.getElementById("generateBtn");
const regenerateBtn = document.getElementById("regenerateBtn");
const downloadBtn = document.getElementById("downloadBtn");
const result = document.getElementById("result");

let currentPrompt = "";
let currentImg = null;

// Function to generate image
function generateImage(prompt) {
  currentPrompt = prompt;

  const img = new Image();

  // Add a random param to force a new image
  const apiUrl = `https://text2img.hideme.eu.org/image?prompt=${encodeURIComponent(prompt)}&model=flux&rand=${Date.now()}`;

  img.crossOrigin = "anonymous"; // Needed for download
  img.src = apiUrl;
  
  img.onload = () => {
    result.innerHTML = "";
    result.appendChild(img);
    currentImg = img;
    regenerateBtn.disabled = false;
    downloadBtn.disabled = false;
  };
  
  img.onerror = () => {
    alert("❌ Failed to generate image.");
  };
}

// Function to download current image
function downloadImage() {
  if (!currentImg) return;

  // Create an invisible link element
  const link = document.createElement("a");
  link.href = currentImg.src;
  link.download = `${currentPrompt.replace(/\s+/g, "_")}_${Date.now()}.png`;
  document.body.appendChild(link);
  link.click();
  document.body.removeChild(link);
}

// Generate button click
generateBtn.addEventListener("click", () => {
  const prompt = promptInput.value.trim();
  if (!prompt) return alert("Please enter a prompt!");
  generateImage(prompt);
});

// Regenerate button click
regenerateBtn.addEventListener("click", () => {
  if (!currentPrompt || !currentImg) return;

  currentImg.src = `https://text2img.hideme.eu.org/image?prompt=${encodeURIComponent(currentPrompt)}&model=flux&rand=${Date.now()}`;
});

// Download button click
downloadBtn.addEventListener("click", downloadImage);

</script>

</body>
</html>
